<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Image Slider</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: transparent;
      overflow-x: hidden;
    }

    .slider-container {
      max-width: 1200px;
      margin: 0 auto 50px;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .slider-title {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 20px;
      color: #333;
    }

    .width-slider .main-image-container {
      position: relative;
      width: 100%;
      height: 400px;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 20px;
    }

    .width-slider .main-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
      position: absolute;
      top: 0;
      left: 0;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    }

    .width-slider .main-image.active {
      opacity: 1;
    }

    .length-slider .main-image-container {
      position: relative;
      width: 300px;
      height: 500px;
      border-radius: 8px;
      overflow: hidden;
      margin: 0 auto 20px;
    }

    .length-slider .main-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
      position: absolute;
      top: 0;
      left: 0;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    }

    .length-slider .main-image.active {
      opacity: 1;
    }

    .arrow-button {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255, 255, 255, 0.9);
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 20px;
      color: #333;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      transition: all 0.3s;
    }

    .arrow-button:hover {
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .arrow-button.prev {
      left: 15px;
    }

    .arrow-button.next {
      right: 15px;
    }

    .thumbnails-container {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      padding: 10px 0;
      scrollbar-width: thin;
    }

    .thumbnails-container::-webkit-scrollbar {
      height: 6px;
    }

    .thumbnails-container::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 3px;
    }

    .thumbnails-container::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 3px;
    }

    .thumbnails-container::-webkit-scrollbar-thumb:hover {
      background: #555;
    }

    .width-slider .thumbnail {
      width: 120px;
      height: 80px;
      object-fit: cover;
      border-radius: 5px;
      cursor: pointer;
      border: 3px solid transparent;
      transition: all 0.3s;
      flex-shrink: 0;
    }

    .length-slider .thumbnail {
      width: 60px;
      height: 100px;
      object-fit: cover;
      border-radius: 5px;
      cursor: pointer;
      border: 3px solid transparent;
      transition: all 0.3s;
      flex-shrink: 0;
    }

    .thumbnail:hover {
      transform: scale(1.05);
      border-color: #ddd;
    }

    .thumbnail.active {
      border-color: #007bff;
      box-shadow: 0 0 10px rgba(0,123,255,0.3);
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }
  </style>
</head>
<body>

  <div class="slider-container width-slider">
    <div class="main-image-container" id="width-image-container">
      <button class="arrow-button prev" onclick="changeImage('width', -1)">‹</button>
      <button class="arrow-button next" onclick="changeImage('width', 1)">›</button>
    </div>
    <div class="thumbnails-container" id="width-thumbnails"></div>
  </div>

  <div class="slider-container length-slider">
    <div class="main-image-container" id="length-image-container">
      <button class="arrow-button prev" onclick="changeImage('length', -1)">‹</button>
      <button class="arrow-button next" onclick="changeImage('length', 1)">›</button>
    </div>
    <div class="thumbnails-container" id="length-thumbnails"></div>
  </div>

  <script>
    const sliders = {
      width: { currentIndex: 0, images: [] },
      length: { currentIndex: 0, images: [] }
    };

    function createSlider(type, imageUrls) {
      if (!imageUrls || imageUrls.length === 0) {
        document.querySelector(`.${type}-slider`).innerHTML = 
          '<div class="loading">이미지가 없습니다.</div>';
        sendHeight();
        return;
      }

      sliders[type].images = imageUrls;
      sliders[type].currentIndex = 0;

      const imageContainer = document.getElementById(`${type}-image-container`);
      const arrows = imageContainer.querySelectorAll('.arrow-button');
      imageContainer.innerHTML = '';
      
      // 모든 이미지를 미리 생성
      imageUrls.forEach((url, index) => {
        const img = document.createElement('img');
        img.src = url;
        img.className = `main-image ${index === 0 ? 'active' : ''}`;
        img.alt = `${type} image ${index + 1}`;
        imageContainer.appendChild(img);
      });

      // 화살표 버튼 다시 추가
      arrows.forEach(arrow => imageContainer.appendChild(arrow));

      const thumbnailsContainer = document.getElementById(`${type}-thumbnails`);
      thumbnailsContainer.innerHTML = '';

      imageUrls.forEach((url, index) => {
        const thumbnail = document.createElement('img');
        thumbnail.src = url;
        thumbnail.className = `thumbnail ${index === 0 ? 'active' : ''}`;
        thumbnail.alt = `${type} thumbnail ${index + 1}`;
        thumbnail.onclick = () => goToImage(type, index);
        thumbnailsContainer.appendChild(thumbnail);
      });

      // 첫 이미지 로드 후 높이 전송
      const firstImage = imageContainer.querySelector('.main-image');
      if (firstImage) {
        firstImage.onload = () => sendHeight();
      }
    }

    function changeImage(type, direction) {
      const slider = sliders[type];
      const totalImages = slider.images.length;

      if (totalImages === 0) return;

      slider.currentIndex += direction;

      if (slider.currentIndex < 0) {
        slider.currentIndex = totalImages - 1;
      } else if (slider.currentIndex >= totalImages) {
        slider.currentIndex = 0;
      }

      updateSlider(type);
    }

    function goToImage(type, index) {
      sliders[type].currentIndex = index;
      updateSlider(type);
    }

    function updateSlider(type) {
      const slider = sliders[type];
      const currentIndex = slider.currentIndex;

      // 모든 메인 이미지에서 active 클래스 제거하고 현재 이미지에만 추가
      const mainImages = document.querySelectorAll(`#${type}-image-container .main-image`);
      mainImages.forEach((img, index) => {
        if (index === currentIndex) {
          img.classList.add('active');
        } else {
          img.classList.remove('active');
        }
      });

      // 썸네일 업데이트
      const thumbnails = document.querySelectorAll(`#${type}-thumbnails .thumbnail`);
      thumbnails.forEach((thumbnail, index) => {
        if (index === currentIndex) {
          thumbnail.classList.add('active');
          thumbnail.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
        } else {
          thumbnail.classList.remove('active');
        }
      });
    }

    function sendHeight() {
      const height = document.body.scrollHeight;
      window.parent.postMessage({ height: height }, '*');
    }

    fetch("https://iyusei02-lgtm.github.io/images/width.json")
      .then((response) => response.json())
      .then((imageUrls) => {
        console.log("Width images:", imageUrls);
        createSlider('width', imageUrls);
      })
      .catch((error) => {
        console.error("Error loading width images:", error);
        document.querySelector('.width-slider').innerHTML = 
          '<div class="loading">이미지를 불러오는 중 오류가 발생했습니다.</div>';
        sendHeight();
      });

    fetch("https://iyusei02-lgtm.github.io/images/length.json")
      .then((response) => response.json())
      .then((imageUrls) => {
        console.log("Length images:", imageUrls);
        createSlider('length', imageUrls);
      })
      .catch((error) => {
        console.error("Error loading length images:", error);
        document.querySelector('.length-slider').innerHTML = 
          '<div class="loading">이미지를 불러오는 중 오류가 발생했습니다.</div>';
        sendHeight();
      });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') {
        changeImage('width', -1);
      } else if (e.key === 'ArrowRight') {
        changeImage('width', 1);
      }
    });

    window.addEventListener('resize', sendHeight);
    window.addEventListener('load', sendHeight);
  </script>

</body>
</html>
